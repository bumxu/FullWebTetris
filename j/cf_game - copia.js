var Game;Game=function(){function n(n){var t;e=n,M(),F=j[e.set],t=J(e.mapPad),u=t.map,f=t.topLine,l=s,O=V(),e.shadeOn&&H(),Q(),y=V(),h=requestAnimFrame(G)}n.displayName="Game";var e,t,r,o,i,a,u,f,h,c,d,l,m,w,s,g,p,v,j,A,F,O,y,b,q,M,z,G,_,k,C,x,I,P,R,T,D,E,L,S,N,U,B,H,J,K,Q,V,W,X,Y,Z=n.prototype;return e=void 0,t=Math.PI,r=void 0,o="undefined",i=$("canvas#board").get(0),a=i.getContext("2d"),u=r,f=0,h=c=r,d=0,l=r,m=0,w=1,s=2,g=0,p=v=15,j={},j.testing=[[[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]]],j.classic=[[[1,1,0],[0,1,1]],[[0,1,1],[1,1,0]],[[1,1],[1,1]],[[1,1,1,1]],[[0,1,0],[1,1,1],[0,0,0]],[[1,0,0],[1,1,1],[0,0,0]],[[0,0,1],[1,1,1],[0,0,0]]],j.extended=j.classic.concat([[[1,0],[1,1]],[[0,1],[1,1]],[[1]],[[1,1]]]),j.challenge=j.extended.concat([[[0,1,0],[1,1,1],[0,1,0]],[[0,1,1],[0,1,1],[1,1,0]],[[1,1,0],[1,1,0],[0,1,1]],[[0,1,1],[0,1,1],[1,1,1]],[[1,1,0],[1,1,0],[1,1,1]],[[1,1,1],[1,1,0]],[[1,1,0],[1,1,1]],[[1,0,1],[1,1,1]],[[1,1,1]],[[0,0,1],[1,1,1],[1,0,0]],[[1,0,0],[1,1,1],[0,0,1]],[[1,0,0],[1,1,0],[1,1,1]],[[0,0,1],[0,1,1],[1,1,1]],[[0,1,0],[1,1,1],[1,1,0]],[[0,1,0],[1,1,1],[0,1,1]]]),j.lethal=j.challenge.concat([[[1,1,1],[1,1,0],[0,1,1]],[[1,1,1],[0,1,1],[1,1,0]],[[1,1,0],[0,1,1],[1,1,0]],[[1,1,0],[1,1,1],[0,1,1]],[[1,1,1,1,1,1,1,1]],[[0,0,1],[0,1,0],[1,0,0]],[[1,0,1],[0,1,0],[1,0,1]],[[0,0,1],[0,1,0],[1,0,1]],[[0,1,1],[1,1,0],[1,0,0]],[[0,1],[1,0]],[[0,1],[1,1],[1,1],[0,1],[0,1]],[[1,0],[1,1],[1,1],[1,0],[1,0]],[[0,1],[1,1],[1,1],[0,1],[1,1]],[[1,1],[1,0],[1,1],[1,0],[1,1]],[[1,1],[1,0],[0,1],[1,0],[0,1]],[[1,0],[1,1],[1,1],[1,0],[1,1]],[[1,1],[0,1],[1,0],[0,1],[1,0]],[[1,1,1],[1,0,1],[1,1,1]],[[1,1,1],[0,0,1],[1,1,1]],[[1,1,0],[1,0,1],[1,0,1]],[[1,1,0],[1,1,1],[1,0,1]],[[0,1,1],[1,0,1],[1,0,1]],[[0,1,1],[1,1,1],[1,0,1]],[[0,1,0],[1,1,1],[1,0,1]],[[1,1,1],[0,1,0],[1,1,1]]]),A=["red","green","blue","cyan","purple","orange","yellow","brown","emerald","pink","white"],F=O=y=b=void 0,q=new Image,q.src="g/material/iced-o.png",window.requestAnimFrame=function(){return window.requestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||window.webkitRequestAnimationFrame||function(n){return window.setTimeout(n,1e3/60)}}(),window.cancelAnimFrame=function(){return window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.msCancelAnimationFrame||window.oCancelAnimationFrame||window.webkitCancelAnimationFrame||window.clearTimeout}(),M=function(){Y(e.width)&&(e.width=16),Y(e.height)&&(e.height=24),Y(e.mapPad)&&(e.mapPad=0),Y(e.set)&&(e.set="extended"),Y(e.rotate)&&(e.rotate="cc"),Y(e.theme)&&(e.theme="iced"),Y(e.ccolorsOn)&&(e.ccolorsOn=!0),Y(e.shadeOn)&&(e.shadeOn=!1),Y(e.zerogOn)&&(e.zerogOn=!1)},z=function(){throw Error("unimplemented")},G=function(){if(h=requestAnimFrame(G),l===s){if(g>p){if(g=0,K(O))O.j++;else{if(N(O)===!1)return k(),void 0;O=y,y=V(),e.shadeOn&&H()}Q()}return d++,g++}},_=function(){return cancelAnimFrame(h),l=m,Q(),!0},k=function(){return console.log("Game over"),_()},C=function(){return console.log("Game interrupted"),_()},x=function(){return l===m?!1:(l===w&&W(!1),P()?(O.i++,e.shadeOn&&H(),Q(),!0):!1)},I=function(){return l===m?!1:(l===w&&W(!1),R()?(O.i--,e.shadeOn&&H(),Q(),!0):!1)},P=function(){var n,t,r,o,i,a,f;for(n=0,t=O.h;t>n;++n)for(r=n,o=O.w-1;o>=0;--o)if(i=o,0!==O._(i,r)){if(a=O.i+i+1,f=O.j+r,a>=e.width||O.j+r-1>-1&&null!==u[f][a]&&1===u[f][a].t)return!1;break}return!0},R=function(){var n,e,t,r,o,i,a,f;for(n=0,e=O.h;e>n;++n)for(t=n,r=0,o=O.w;o>r;++r)if(i=r,0!==O._(i,t)){if(a=O.i+i-1,f=O.j+t,-1>=a||O.j+t-1>-1&&null!==u[f][a]&&1===u[f][a].t)return!1;break}return!0},T=function(){var n,t,r,o,i,a,u,f,h;if(l===m)return!1;for(l===w&&W(!1),n=new Array(O.w),t=0,r=n.length;r>t;++t)o=t,n[o]=new Array(O.h);for(i=O.w-1,t=0,r=n.length;r>t;++t){for(o=t,a=0,u=n[0].length;u>a;++a)f=a,n[o][f]=O._(i,f);i--}return O.s=n,h=O.w,O.w=O.h,O.h=h,e.shadeOn&&H(),Q(),!0},D=function(){return"c"===e.rotate?rotateC():T()},E=function(){return l===m?!1:(l===w&&W(!1),p=1,!0)},L=function(){return p=v,!0},S=function(){if(l===m)return!1;for(l===w&&W(!1);K(O);)O.j++;return N(O)===!1?k():(O=y,y=V(),e.shadeOn&&H(),Q(),g=0,!0)},N=function(n){var e,t,r,o,i,a;for(e=n.h-1;e>=0;--e)for(t=e,r=0,o=n.w;o>r;++r)if(i=r,0!==n._(i,t)){if(!(n.j+t>-1))return!1;u[n.j+t][n.i+i]={t:n.t,c:n.c}}return f=(a=O.j)<f?a:f,U(),!0},U=function(){var n,t,r,o,i,a,c,d,l,m,w,s,g;for(n=[],t=O.j+O.h-1,r=O.j;t>=r;--t)if(o=t,!(o>=24)){for(i=0,a=0,c=e.width;c>a&&(d=a,null!==u[o][d]);++a)i++;i===e.width&&n.push(o)}if(n.push(f-1),1===n.length)return!1;for(t=0,r=n.length;r>t;++t){for(l=t,a=0,c=e.width;c>a;++a){d=a;try{u[n[l]][d]=null}catch(p){}}for(a=n[l]-1,c=n[l+1];a>c;--a)for(o=a,console.log("Fila "+o+" deberÃ¡ bajar "+(l+1)),m=0,w=e.width;w>m;++m)d=m,null!==u[o][d]&&(u[o][d].t$=l+1,u[o][d].o$=0)}cancelAnimFrame(h),s=1,g=function(){var t,r,o,i,a,c,d;if(!(s>0))return h=requestAnimFrame(G),void 0;for(requestAnimFrame(g),s=0,t=n[0]-1,r=f;t>=r;--t)for(o=t,i=0,a=e.width;a>i;++i)c=i,null!==u[o][c]&&0!==u[o][c].t$&&(u[o][c].o$<u[o][c].t$&&(u[o][c].o$=Math.floor(100*(u[o][c].o$+.25))/100,s++),u[o][c].o$===u[o][c].t$&&(d=u[o][c].t$,u[o][c].t$=0,u[o][c].o$=0,u[o+d][c]=X(u[o][c]),u[o][c]=null));return Q()},g()},B=function(){var n,t,r,o,i,a,h,c,d,l,m,w;for(n=0,t=O.h-1;t>=0;--t){for(r=t,o=0,i=0,a=e.width;a>i&&(h=i,null!==u[O.j+r][h]);++i)o++;if(o===e.width){for(i=O.j+r,a=f;i>a;--i)for(c=i,d=0,l=e.width;l>d;++d)m=d,u[c][m]=X(u[c-1][m]);for(i=0,a=e.width;a>i;++i)m=i,u[f][m]=null;f++,r++,n++}}return n>0?(w=[10,25,75,300],!0):!1},H=function(){for(b=X(O);K(b);)b.j++},J=function(n){var t,r,o,i,a,u,f;for("undefined"==typeof n&&(n=0),t=function(){var n,t,r=[];for(n=0,t=e.width;t>n;++n)r.push(null);return r},r=function(){var n,t,r=[];for(n=0,t=e.width;t>n;++n)1===Math.round(Math.random())?r.push({t:1,c:"black"}):r.push(null);return r},i=[],a=0,u=e.height-n;u>a;++a)i.push(t());for(o=i,i=[],a=0;n>a;++a)i.push(r());return f=i,{map:o.concat(f),topLine:e.height-1}},K=function(n){var t,r,o,i,a,f,h;for(t=0,r=n.w;r>t;++t)for(o=t,i=n.h-1;i>=0;--i)if(a=i,0!==n._(o,a)&&n.j+a+1>-1&&(f=n.i+o,h=n.j+a+1,h>=e.height||1===(null!==u[h][f]&&u[h][f].t)))return!1;return!0},Q=function(){var n,t,r,o,f,h,c,d,w,s,g,p=[];for(a.clearRect(0,0,i.width,i.height),n=i.height/e.height,t=0,r=e.height;r>t;++t)for(o=t,f=0,h=e.width;h>f;++f)c=f,null!==u[o][c]&&(d=n*c,w=n*(e.zerogOn?e.height-1-o:o),s="undefined"!=typeof u[o][c].o$?n*u[o][c].o$:0,a.drawImage(q,d,w+s,n,n));if(l!==m){for(t=0,r=O.h;r>t;++t){for(o=t,g=[],f=0,h=O.w;h>f;++f)c=f,1===O._(c,o)&&(d=c*n+O.i*n,w=n*(e.zerogOn?O.h-1-o:o)+n*(e.zerogOn?e.height-1-O.j:O.j),g.push(a.drawImage(q,d,w,n,n)));p.push(g)}return p}},V=function(){var n,t,r,o,i;return n=Math.round(Math.random()*(F.length-1)),t=F[n],r=Math.round(e.width/2)-Math.round(t.length/2),o=-1*t.length,i={i:r,j:o,w:t[0].length,h:t.length,t:1,s:t,_:function(n,e){return this.s[e][n]}},i.c=!e.ccolorsOn||"classic"!==e.set&&"extended"!==e.set?A[Math.round(Math.random()*(A.length-1))]:A[n],i},W=function(n){n===!1?l===w&&(l=s,Q()):n===!0?l===s&&(l=w,Q()):l===w?(l=s,Q()):l===s&&(l=w,Q())},X=function(n){var e,t,r,o,i;if(null===n||"object"!=typeof n)return n;if(n instanceof Date)return e=new Date,e.setTime(n.getTime()),e;if(n instanceof Array){for(e=[],t=n.length,r=0;t>r;++r)o=r,e[o]=X(n[o]);return e}if(n instanceof Object){e={};for(i in n)n.hasOwnProperty(i)&&(e[i]=X(n[i]));return e}throw new Error("Unable to copy obj! Its type isn't supported.")},Y=function(n){return"undefined"==typeof n},Z.pauseGame=W,Z.endGame=C,Z.left=I,Z.right=x,Z.rotate=D,Z.fastSpeed=E,Z.normalSpeed=L,Z.drop=S,n}();