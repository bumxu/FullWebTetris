var Game;Game=function(e){var n,t,i,r,o,a,c,u,f,s,h,l,d,m,w,g,p,j,O,v,A,y,F,b,I,q,z,M,G,_,k,x,C,R,T,D,P,E,U,B,H,J,K,L,N;N=Math.PI,K=void 0,L="undefined",u=$("canvas#board").get(0),d=u.getContext("2d"),_=K,J=0,f=v=K,O=0,H=K,t=0,i=1,n=2,g=0,j=C=15,E={},E.classic=[[[1,1,0],[0,1,1]],[[0,1,1],[1,1,0]],[[1,1],[1,1]],[[1,1,1,1]],[[0,1,0],[1,1,1]],[[1,0,0],[1,1,1]],[[0,0,1],[1,1,1]]],E.extended=E.classic.concat([[[1,0],[1,1]],[[0,1],[1,1]],[[1]],[[0,0],[1,1]]]),E.challenge=E.extended.concat([[[0,1,0],[1,1,1],[0,1,0]],[[0,1,1],[0,1,1],[1,1,0]],[[1,1,0],[1,1,0],[0,1,1]],[[0,1,1],[0,1,1],[1,1,1]],[[1,1,0],[1,1,0],[1,1,1]],[[1,1,1],[1,1,0]],[[1,1,0],[1,1,1]],[[1,0,1],[1,1,1]],[[1,1,1]],[[0,0,1],[1,1,1],[1,0,0]],[[1,0,0],[1,1,1],[0,0,1]],[[1,0,0],[1,1,0],[1,1,1]],[[0,0,1],[0,1,1],[1,1,1]],[[0,1,0],[1,1,1],[1,1,0]],[[0,1,0],[1,1,1],[0,1,1]]]),E.lethal=E.challenge.concat([[[1,1,1],[1,1,0],[0,1,1]],[[1,1,1],[0,1,1],[1,1,0]],[[1,1,0],[0,1,1],[1,1,0]],[[1,1,0],[1,1,1],[0,1,1]],[[1,1,1,1,1,1,1,1]],[[0,0,1],[0,1,0],[1,0,0]],[[1,0,1],[0,1,0],[1,0,1]],[[0,0,1],[0,1,0],[1,0,1]],[[0,1,1],[1,1,0],[1,0,0]],[[0,1],[1,0]],[[0,1],[1,1],[1,1],[0,1],[0,1]],[[1,0],[1,1],[1,1],[1,0],[1,0]],[[0,1],[1,1],[1,1],[0,1],[1,1]],[[1,1],[1,0],[1,1],[1,0],[1,1]],[[1,1],[1,0],[0,1],[1,0],[0,1]],[[1,0],[1,1],[1,1],[1,0],[1,1]],[[1,1],[0,1],[1,0],[0,1],[1,0]],[[1,1,1],[1,0,1],[1,1,1]],[[1,1,1],[0,0,1],[1,1,1]],[[1,1,0],[1,0,1],[1,0,1]],[[1,1,0],[1,1,1],[1,0,1]],[[0,1,1],[1,0,1],[1,0,1]],[[0,1,1],[1,1,1],[1,0,1]],[[0,1,0],[1,1,1],[1,0,1]],[[1,1,1],[0,1,0],[1,1,1]]]),l=["red","green","blue","cyan","purple","orange","yellow","brown","emerald","pink","white"],B=m=x=U=K,w=new Image,w.src="g/material/iced-o.png",b={iced:{},classic:{o:[],t:[]}},b.iced.o=new Image,b.iced.o.src="g/material/iced-o.png",b.iced.o.onload=function(){},b.iced.t=new Image,b.iced.t.src="g/material/iced-t.png",b.iced.t.onload=function(){};for(k in l)h=l[k],b.classic.o[k]=new Image,b.classic.o[k].src="g/material/classic-o-"+h+".png",b.classic.o[k].onload=function(){},b.classic.t[k]=new Image,b.classic.t[k].src="g/material/classic-t-"+h+".png",b.classic.t[k].onload=function(){};window.requestAnimFrame=function(){return window.requestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||window.webkitRequestAnimationFrame||function(e){return window.setTimeout(e,1e3/60)}}(),window.cancelAnimFrame=function(){return window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.msCancelAnimationFrame||window.oCancelAnimationFrame||window.webkitCancelAnimationFrame||window.clearTimeout}(),I=function(){typeof e.width===L&&(e.width=24),typeof e.height===L&&(e.height=17),typeof e.set===L&&(e.set="extended"),typeof e.theme===L&&(e.theme="iced"),typeof e.ccolorsOn===L&&(e.ccolorsOn=!0),typeof e.shadeOn===L&&(e.shadeOn=!1),typeof e.zerogOn===L&&(e.zerogOn=!0),B=E[e.set],_=z(),H=n,m=M(),e.shadeOn&&G(),D(),x=M(),f=requestAnimFrame(T)},T=function(){if(f=requestAnimFrame(T),H===n){if(g>j){if(g=0,o(m))m.j++;else{if(A(m)===!1)return F(),void 0;m=x,x=M(),e.shadeOn&&G()}D()}return O++,g++}},r=function(){return cancelAnimFrame(f),H=t,D(),!0},F=function(){return console.log("Game over"),r()},p=function(){return console.log("Game interrupted"),r()},P=function(){return H===t?!1:(H===i&&R(!1),c()?(m.i++,e.shadeOn&&G(),D(),!0):!1)},q=function(){return H===t?!1:(H===i&&R(!1),a()?(m.i--,e.shadeOn&&G(),D(),!0):!1)},c=function(){var n,t,i,r,o,a,c,u;if(m.i+m.w+1>e.width)return!1;for(t=o=0,c=m.h;c>=0?c>o:o>c;t=c>=0?++o:--o)for(n=a=u=m.w-1;0>=u?0>=a:a>=0;n=0>=u?++a:--a)if(0!==m._(n,t)){if(i=m.i+n+1,r=m.j+t,m.j+t-1>-1&&null!==_[r][i]&&1===_[r][i].t)return!1;break}return!0},a=function(){var e,n,t,i,r,o,a,c;if(m.i-1<0)return!1;for(n=r=0,a=m.h;a>=0?a>r:r>a;n=a>=0?++r:--r)for(e=o=0,c=m.w;c>=0?c>o:o>c;e=c>=0?++o:--o)if(0!==m._(e,n)){if(t=m.i+e-1,i=m.j+n,m.j+n-1>-1&&null!==_[i][t]&&1===_[i][t].t)return!1;break}return!0},A=function(e){var n,t,i,r,o,a;for(t=i=o=e.h-1;0>=o?0>=i:i>=0;t=0>=o?++i:--i)for(n=r=0,a=e.w;a>=0?a>r:r>a;n=a>=0?++r:--r)if(0!==e._(n,t)){if(!(e.j+t>-1))return!1;_[e.j+t][e.i+n]={t:e.t,c:e.c}}return J=Math.min(m.j,J),!0},G=function(){for(U=s(m);o(U);)U.j++},z=function(n){var t,i,r;return typeof n===L&&(r=function(){var n,t,i,r;for(r=[],n=t=0,i=e.width;i>=0?i>t:t>i;n=i>=0?++t:--t)r.push(null);return r},i=function(){var n,i,o;for(o=[],t=n=0,i=e.height;i>=0?i>n:n>i;t=i>=0?++n:--n)o.push(r());return o}()),i},o=function(n){var t,i,r,o,a,c,u,f;if(n.j+n.h===e.height)return!1;for(t=a=0,u=n.w;u>=0?u>a:a>u;t=u>=0?++a:--a)for(i=c=f=n.h-1;0>=f?0>=c:c>=0;i=0>=f?++c:--c)if(0!==n._(t,i)&&n.j+i+1>-1&&(r=n.i+t,o=n.j+i+1,null!==_[o][r]&&1===_[o][r].t))return!1;return!0},y=function(n){return e.zerogOn?e.height-1-n:n},D=function(){var n,i,r,o,a,c,f,s,h,l,g,p,j;for(d.clearRect(0,0,u.width,u.height),r=u.height/e.height,i=c=0,l=e.height;l>=0?l>c:c>l;i=l>=0?++c:--c)for(n=f=0,g=e.width;g>=0?g>f:f>g;n=g>=0?++f:--f)null!==_[i][n]&&(o=r*n,a=r*(e.zerogOn?e.height-1-i:i),d.drawImage(w,o,a,r,r));if(H!==t)for(i=s=0,p=m.h;p>=0?p>s:s>p;i=p>=0?++s:--s)for(n=h=0,j=m.w;j>=0?j>h:h>j;n=j>=0?++h:--h)1===m._(n,i)&&(o=n*r+m.i*r,a=r*(e.zerogOn?m.h-1-i:i)+r*(e.zerogOn?e.height-1-m.j:m.j),d.drawImage(w,o,a,r,r))};return M=function(){var n,t,i,r;return r=Math.round(Math.random()*(B.length-1)),n=Math.round(e.width/2)-Math.round(B[r].length/2),t=-1*B[r].length,i={i:n,j:t,w:B[r][0].length,h:B[r].length,t:1,s:B[r],_:function(e,n){return this.s[n][e]}},i.c=!e.ccolorsOn||"classic"!==e.set&&"extended"!==e.set?l[Math.round(Math.random()*(l.length-1))]:l[r],i},R=function(e){e===!1?H===i&&(H=n,D()):e===!0?H===n&&(H=i,D()):H===i?(H=n,D()):H===n&&(H=i,D())},s=function(e){var n,t,i,r,o;if(null===e||"object"!=typeof e)return e;if(e instanceof Date)return t=new Date,t.setTime(e.getTime()),t;if(e instanceof Array){for(t=[],r=e.length,i=o=0;r>=0?r>o:o>r;i=r>=0?++o:--o)t[i]=s(e[i]);return t}if(e instanceof Object){t={};for(n in e)e.hasOwnProperty(n)&&(t[n]=s(e[n]));return t}throw new Error("Unable to copy obj! Its type isn't supported.")},this.pauseGame=R,this.endGame=p,this.left=q,this.right=P,I()};